#+title: С использованием оператора GROUP BY

1. Назначение запроса: таблица количества комнат на каждом этаже

#+BEGIN_SRC sql

# 2022-11-09 00:47:12.761050
select `Floor`, COUNT(*) as `number of rooms` from `Room` group by `Floor`;
+-------+-----------------+
| Floor | number of rooms |
+-------+-----------------+
| 1     | 4               |
| 2     | 5               |
| 3     | 5               |
| 4     | 4               |
| 5     | 1               |
| 6     | 1               |
+-------+-----------------+
6 rows in set
Time: 0.028s

#+END_SRC

2. Назначение запроса: для каждого возраста получить количество людей этого возраста

#+BEGIN_SRC sql

# 2022-11-09 00:49:26.699273
select `People`.`Age`, count(*) from `People` group by `People`.`Age` order by `Age`;
+-----+----------+
| Age | count(*) |
+-----+----------+
| 1   | 1        |
| 4   | 1        |
| 8   | 1        |
| 10  | 1        |
| 20  | 1        |
| 22  | 1        |
| 28  | 1        |
| 42  | 1        |
| 47  | 2        |
| 56  | 1        |
| 62  | 1        |
| 64  | 1        |
| 65  | 1        |
| 66  | 1        |
| 75  | 1        |
| 79  | 1        |
| 86  | 1        |
| 90  | 1        |
| 91  | 1        |
+-----+----------+
19 rows in set
Time: 0.015s

#+END_SRC

3. Назначение запроса: для каждого класса номера получить его среднюю стоимость покупки

#+BEGIN_SRC sql

# 2022-11-09 00:54:51.382907
select r.`Class`, avg(h.`Price`) as `avg price` from
`HotelOrder` h inner join `Room` r using(room_id)
group by r.`Class`;
+----------+-------------+
| Class    | avg price   |
+----------+-------------+
| standart | 232165.0000 |
| half vip | 287194.2222 |
| vip      | 479318.0000 |
+----------+-------------+
3 rows in set
Time: 0.017s

#+END_SRC

4. Назначение запроса: найти сколько в отеле есть номеров различной вместимости

#+BEGIN_SRC sql

# 2022-11-08 14:54:30.365581
select `Room`.`Capacity`, count( `Capacity` ) from `Room` group by `Room`.`Capacity` order by `Capacity`
+----------+---------------------+
| Capacity | count( `Capacity` ) |
+----------+---------------------+
| 1        | 5                   |
| 2        | 5                   |
| 3        | 5                   |
| 4        | 5                   |
+----------+---------------------+
4 rows in set
Time: 0.019s
#+END_SRC

5. Назначение запроса: таблица людей с потраченной ими суммой на заказы

#+BEGIN_SRC sql

# 2022-11-08 17:40:11.103345
select `People`.`Full_name` as 'name', sum(`HotelOrder`.`Price`) as 'sum'
from (`People` inner join `HotelOrder`
on `People`.person_id = `HotelOrder`.person_id) group by `People`.`Full_name`;

+-------------------+--------+
| name              | sum    |
+-------------------+--------+
| Джолин Агацума    | 208037 |
| Роуз Геноза       | 467315 |
| Джонатан Макинами | 348189 |
| Дива Почитта      | 66062  |
| Фэй Джостар       | 563270 |
| Роуз Ленгли       | 301181 |
| Даниил Куджо      | 943745 |
| Жоржи Мухаммед    | 677814 |
| Мива Макинами     | 4371   |
| Джонатан Ленгли   | 813169 |
| Дива Агацума      | 524880 |
| Кира Мухаммед     | 467683 |
+-------------------+--------+
12 rows in set
Time: 0.072s

#+END_SRC

6. Назначение запроса: таблица всех номеров с их оценками

#+BEGIN_SRC sql

# 2022-11-10 01:04:39.434477
select r.`Floor`, r.`Number`, AVG( h.`Stars` ) from
`Room` r left join `HotelOrder` h on r.room_id = h.room_id
group by r.`Floor`, r.`Number`
order by r.`Floor`, r.`Number`;
+-------+--------+------------------+
| Floor | Number | AVG( h.`Stars` ) |
+-------+--------+------------------+
| 1     | 1      | 1.0000           |
| 1     | 2      | <null>           |
| 1     | 3      | 3.5000           |
| 1     | 4      | 3.5000           |
| 2     | 1      | <null>           |
| 2     | 2      | <null>           |
| 2     | 3      | 3.0000           |
| 2     | 4      | 5.0000           |
| 2     | 5      | 0.0000           |
| 3     | 1      | 2.0000           |
| 3     | 2      | 3.0000           |
| 3     | 3      | 5.0000           |
| 3     | 4      | <null>           |
| 3     | 5      | <null>           |
| 4     | 1      | 5.0000           |
| 4     | 2      | 4.0000           |
| 4     | 3      | 4.0000           |
| 4     | 4      | 1.0000           |
| 5     | 1      | 2.3333           |
| 6     | 1      | 0.0000           |
+-------+--------+------------------+
20 rows in set
Time: 0.030s

#+END_SRC
