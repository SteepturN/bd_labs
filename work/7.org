#+title: С использованием вложенных запросов

1. Назначение запроса: таблица с людьми младше 18 лет, купившими номер, и потраченные ими деньги на номер

#+BEGIN_SRC sql

# 2022-11-08 22:08:40.307634
select p.`Full_name`, h.`Price` from `People` p inner join `HotelOrder` h using (person_id)
where p.`Full_name` in ( select `People`.`Full_name` from `People` where `Age` < 18 );
+-------------+--------+
| Full_name   | Price  |
+-------------+--------+
| Роуз Ленгли | 288016 |
| Роуз Ленгли | 13165  |
+-------------+--------+
2 rows in set
Time: 0.020s

#+END_SRC

2. Назначение запроса: таблица с заказами со стоимостью больше средней

#+BEGIN_SRC sql

# 2022-11-08 22:10:37.225122
select * from `HotelOrder` where `Price` > (select avg( `Price` ) from `HotelOrder`);
+------------+--------+-------+-----------+---------+----------+
| DateInfo   | Price  | Stars | person_id | room_id | order_id |
+------------+--------+-------+-----------+---------+----------+
| 2001-06-22 | 467315 | 1     | 9         | 1       | 2        |
| 1975-08-11 | 348189 | 3     | 14        | 11      | 3        |
| 2005-12-02 | 288016 | 5     | 16        | 12      | 6        |
| 1997-03-21 | 356811 | 3     | 20        | 3       | 10       |
| 2012-07-21 | 451559 | 5     | 13        | 15      | 11       |
| 1987-09-20 | 451308 | 4     | 6         | 19      | 12       |
| 2007-03-14 | 278408 | 0     | 7         | 9       | 13       |
| 1982-05-01 | 456358 | 4     | 20        | 17      | 14       |
| 1992-01-13 | 479318 | 2     | 7         | 10      | 15       |
| 1982-05-13 | 467683 | 5     | 2         | 8       | 16       |
| 2014-12-07 | 364377 | 4     | 8         | 4       | 18       |
+------------+--------+-------+-----------+---------+----------+
11 rows in set
Time: 0.015s

#+END_SRC

3. Назначение запроса: таблица с людьми старше 18 лет, купившими номер

#+BEGIN_SRC sql

# 2022-11-09 23:55:43.685241
select `People`.`Full_name` as 'people with age > 18'
from ( select * from `People` where `Age` > 18 ) as People;
+----------------------+
| people with age > 18 |
+----------------------+
| Мива Макинами        |
| Кира Мухаммед        |
| Синдзи Почитта       |
| Джолин Лайт          |
| Жоржи Мухаммед       |
| Даниил Куджо         |
| Фэй Джостар          |
| Роуз Геноза          |
| Илья Лайт            |
| Константин Амане     |
| Дива Агацума         |
| Джонатан Макинами    |
| Джолин Агацума       |
| Дива Почитта         |
| Илья Амане           |
| Джонатан Ленгли      |
+----------------------+
16 rows in set
Time: 0.037s

#+END_SRC

4. Назначение запроса: таблица с людьми и со всеми их заказами, ценой, и оценкой

#+BEGIN_SRC sql

# 2022-11-11 00:53:38.666466
select `Full_name`,
(select group_concat(concat(r.`Floor`, ':', r.`Number`,
' - ', r.`Class`, ' - ', h.`Price`, ' - rating = ', h.`Stars`, '\n')
order by r.Floor, r.`Number`, r.`Class`, h.`Price` separator '')
from `HotelOrder` h inner join `Room` r
using(room_id)
where h.person_id = p.person_id) as `orders`
from `People` p
order by p.`Full_name`;
+-------------------+--------------------------------------+
| Full_name         | orders                               |
+===================+======================================+
| Даниил Куджо      | 2:5 - half vip - 278408 - rating = 0 |
|                   | 3:1 - vip - 479318 - rating = 2      |
|                   | 4:2 - half vip - 186019 - rating = 4 |
+-------------------+--------------------------------------+
| Джозеф Джостар    | <null>                               |
+-------------------+--------------------------------------+
| Джолин Агацума    | 6:1 - standart - 208037 - rating = 0 |
+-------------------+--------------------------------------+
| Джолин Лайт       | <null>                               |
+-------------------+--------------------------------------+
| Джонатан Ленгли   | 1:3 - half vip - 356811 - rating = 3 |
|                   | 4:3 - half vip - 456358 - rating = 4 |
+-------------------+--------------------------------------+
| Джонатан Макинами | 3:2 - half vip - 348189 - rating = 3 |
+-------------------+--------------------------------------+
| Джонатан Почитта  | <null>                               |
+-------------------+--------------------------------------+
| Джорно Йошикаге   | <null>                               |
+-------------------+--------------------------------------+
| Дива Агацума      | 4:1 - standart - 451559 - rating = 5 |
|                   | 6:1 - standart - 73321 - rating = 0  |
+-------------------+--------------------------------------+
| Дива Почитта      | 5:1 - standart - 66062 - rating = 1  |
+-------------------+--------------------------------------+
| Жоржи Мухаммед    | 1:4 - standart - 14165 - rating = 3  |
|                   | 4:4 - standart - 212341 - rating = 1 |
|                   | 5:1 - standart - 451308 - rating = 4 |
+-------------------+--------------------------------------+
| Илья Амане        | <null>                               |
+-------------------+--------------------------------------+
| Илья Лайт         | <null>                               |
+-------------------+--------------------------------------+
| Кира Мухаммед     | 2:4 - half vip - 467683 - rating = 5 |
+-------------------+--------------------------------------+
| Константин Амане  | <null>                               |
+-------------------+--------------------------------------+
| Мива Макинами     | 2:3 - half vip - 4371 - rating = 3   |
+-------------------+--------------------------------------+
| Роуз Геноза       | 1:1 - standart - 467315 - rating = 1 |
+-------------------+--------------------------------------+
| Роуз Ленгли       | 3:3 - half vip - 288016 - rating = 5 |
|                   | 5:1 - standart - 13165 - rating = 2  |
+-------------------+--------------------------------------+
| Синдзи Почитта    | <null>                               |
+-------------------+--------------------------------------+
| Фэй Джостар       | 1:3 - half vip - 198893 - rating = 4 |
|                   | 1:4 - standart - 364377 - rating = 4 |
+-------------------+--------------------------------------+
20 rows in set
Time: 0.068s

#+END_SRC

5. Назначение запроса: таблица с датами прибывания в гостинице определённого человека

#+BEGIN_SRC sql

# 2022-11-11 01:25:07.030154
select 'Фей Джостар' as `name`, h.`DateInfo` from `HotelOrder` h where h.person_id =
(select person_id from `People` where `Full_name` = 'Фэй Джостар');
+-------------+------------+
| name        | DateInfo   |
+=============+============+
| Фей Джостар | 2007-08-24 |
+-------------+------------+
| Фей Джостар | 2014-12-07 |
+-------------+------------+
2 rows in set
Time: 0.011s

#+END_SRC
