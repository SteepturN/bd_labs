#+title: С использованием нескольких таблиц


1. Назначение запроса: получить список людей, которые заказывали vip номера со стоимостью их заказов

#+BEGIN_SRC sql

# 2022-11-08 17:44:06.927839
select `People`.`Full_name` as 'vip', `HotelOrder`.`Price` as 'vip price'
from (`People` inner join
(`HotelOrder` inner join ( select `Room`.room_id from `Room` where `Class` = 'vip' ) as Room
on `HotelOrder`.room_id = `Room`.room_id )
on `People`.person_id = `HotelOrder`.person_id);
+--------------+-----------+
| vip          | vip price |
+--------------+-----------+
| Даниил Куджо | 479318    |
+--------------+-----------+
1 row in set
Time: 0.019s

#+END_SRC

2. Назначение запроса: получить таблицу людей с их пасспортом и id их заказа, даже если они не совершали заказов

#+BEGIN_SRC sql
# 2022-11-08 17:49:52.163105
select `People`.`Full_name` as 'person', `People`.`passport`, `HotelOrder`.`order_id` as 'order_id'
from `People` left join `HotelOrder` on `People`.person_id = `HotelOrder`.person_id;
+-------------------+------------+----------+
| person            | passport   | order_id |
+-------------------+------------+----------+
| Мива Макинами     | 7818478233 | 9        |
| Кира Мухаммед     | 2702162558 | 16       |
| Синдзи Почитта    | 1713007159 | <null>   |
| Джолин Лайт       | 5955587707 | <null>   |
| Джорно Йошикаге   | 3604628488 | <null>   |
| Жоржи Мухаммед    | 7434294503 | 8        |
| Жоржи Мухаммед    | 7434294503 | 12       |
| Жоржи Мухаммед    | 7434294503 | 17       |
| Даниил Куджо      | 1217562659 | 7        |
| Даниил Куджо      | 1217562659 | 13       |
| Даниил Куджо      | 1217562659 | 15       |
| Фэй Джостар       | 8359314123 | 5        |
| Фэй Джостар       | 8359314123 | 18       |
| Роуз Геноза       | 3218876729 | 2        |
| Джозеф Джостар    | 5720607731 | <null>   |
| Илья Лайт         | 9773355810 | <null>   |
| Константин Амане  | 2616906135 | <null>   |
| Дива Агацума      | 8467356710 | 11       |
| Дива Агацума      | 8467356710 | 19       |
| Джонатан Макинами | 1640823282 | 3        |
| Джонатан Почитта  | 2403008459 | <null>   |
| Роуз Ленгли       | 7478332364 | 6        |
| Роуз Ленгли       | 7478332364 | 20       |
| Джолин Агацума    | 4593159892 | 1        |
| Дива Почитта      | 1529276322 | 4        |
| Илья Амане        | 4097248329 | <null>   |
| Джонатан Ленгли   | 7076427086 | 10       |
| Джонатан Ленгли   | 7076427086 | 14       |
+-------------------+------------+----------+
28 rows in set
Time: 0.022s

#+END_SRC

3. Назначение запроса: получить таблицу людей с их пасспортом и id их заказа, при том что они не совершали заказов

#+BEGIN_SRC sql

# 2022-11-08 17:51:31.667122
select `People`.`Full_name` as 'person', `People`.`passport`, `HotelOrder`.`order_id` as 'order_id'
from `People` left join `HotelOrder` on `People`.person_id = `HotelOrder`.person_id where `order_id` <=> null;
+------------------+------------+----------+
| person           | passport   | order_id |
+------------------+------------+----------+
| Синдзи Почитта   | 1713007159 | <null>   |
| Джолин Лайт      | 5955587707 | <null>   |
| Джорно Йошикаге  | 3604628488 | <null>   |
| Джозеф Джостар   | 5720607731 | <null>   |
| Илья Лайт        | 9773355810 | <null>   |
| Константин Амане | 2616906135 | <null>   |
| Джонатан Почитта | 2403008459 | <null>   |
| Илья Амане       | 4097248329 | <null>   |
+------------------+------------+----------+
8 rows in set
Time: 0.013s

#+END_SRC

4. Назначение запроса: получить таблицу с номерами и ценой, за которую их покупали

#+BEGIN_SRC sql

# 2022-11-08 18:04:30.356607
select `Room`.`Floor`, `Room`.`Number`, `HotelOrder`.`Price` from `Room` right join
`HotelOrder` on `Room`.room_id = `HotelOrder`.room_id order by `Floor`, `Number`;
+-------+--------+--------+
| Floor | Number | Price  |
+-------+--------+--------+
| 1     | 1      | 467315 |
| 1     | 3      | 198893 |
| 1     | 3      | 356811 |
| 1     | 4      | 364377 |
| 1     | 4      | 14165  |
| 2     | 3      | 4371   |
| 2     | 4      | 467683 |
| 2     | 5      | 278408 |
| 3     | 1      | 479318 |
| 3     | 2      | 348189 |
| 3     | 3      | 288016 |
| 4     | 1      | 451559 |
| 4     | 2      | 186019 |
| 4     | 3      | 456358 |
| 4     | 4      | 212341 |
| 5     | 1      | 451308 |
| 5     | 1      | 66062  |
| 5     | 1      | 13165  |
| 6     | 1      | 208037 |
| 6     | 1      | 73321  |
+-------+--------+--------+
20 rows in set
Time: 0.016s

#+END_SRC

5. Назначение запроса: получить таблицу со всеми номерами и ценой, за которую их покупали, если номер не покупали, то null

#+BEGIN_SRC sql

# 2022-11-08 18:04:49.977408
select `Room`.`Floor`, `Room`.`Number`, `HotelOrder`.`Price` from `Room` left join `HotelOrder` on `Room`.room_id = `HotelOrder`.room_id order by `Floor`, `Number`;
+-------+--------+--------+
| Floor | Number | Price  |
+-------+--------+--------+
| 1     | 1      | 467315 |
| 1     | 2      | <null> |
| 1     | 3      | 198893 |
| 1     | 3      | 356811 |
| 1     | 4      | 14165  |
| 1     | 4      | 364377 |
| 2     | 1      | <null> |
| 2     | 2      | <null> |
| 2     | 3      | 4371   |
| 2     | 4      | 467683 |
| 2     | 5      | 278408 |
| 3     | 1      | 479318 |
| 3     | 2      | 348189 |
| 3     | 3      | 288016 |
| 3     | 4      | <null> |
| 3     | 5      | <null> |
| 4     | 1      | 451559 |
| 4     | 2      | 186019 |
| 4     | 3      | 456358 |
| 4     | 4      | 212341 |
| 5     | 1      | 66062  |
| 5     | 1      | 451308 |
| 5     | 1      | 13165  |
| 6     | 1      | 208037 |
| 6     | 1      | 73321  |
+-------+--------+--------+
25 rows in set
Time: 0.013s
Connecting to socket /var/run/mysqld/mysqld.sock, owned by user mysql

#+END_SRC

6. Назначение запроса: получить таблицу с людьми и номерами, которые они покупали

#+BEGIN_SRC sql
# 2022-11-09 23:39:09.378448
select p.`Full_name`, r.`Number`, r.`Floor`, r.`Class` from `People` p
inner join
(`HotelOrder` h inner join `Room` r on h.room_id = r.room_id)
on p.person_id = h.person_id order by p.`Full_name`, r.`Floor`, r.`Number`;
+-------------------+--------+-------+----------+
| Full_name         | Number | Floor | Class    |
+-------------------+--------+-------+----------+
| Даниил Куджо      | 5      | 2     | half vip |
| Даниил Куджо      | 1      | 3     | vip      |
| Даниил Куджо      | 2      | 4     | half vip |
| Джолин Агацума    | 1      | 6     | standart |
| Джонатан Ленгли   | 3      | 1     | half vip |
| Джонатан Ленгли   | 3      | 4     | half vip |
| Джонатан Макинами | 2      | 3     | half vip |
| Дива Агацума      | 1      | 4     | standart |
| Дива Агацума      | 1      | 6     | standart |
| Дива Почитта      | 1      | 5     | standart |
| Жоржи Мухаммед    | 4      | 1     | standart |
| Жоржи Мухаммед    | 4      | 4     | standart |
| Жоржи Мухаммед    | 1      | 5     | standart |
| Кира Мухаммед     | 4      | 2     | half vip |
| Мива Макинами     | 3      | 2     | half vip |
| Роуз Геноза       | 1      | 1     | standart |
| Роуз Ленгли       | 3      | 3     | half vip |
| Роуз Ленгли       | 1      | 5     | standart |
| Фэй Джостар       | 3      | 1     | half vip |
| Фэй Джостар       | 4      | 1     | standart |
+-------------------+--------+-------+----------+
20 rows in set
Time: 0.201s


#+END_SRC
